# Development

## Initial setup
* Clone the repo
* Copy the `.env` values from LastPass (hint: search `hmrc interface env`)
* Run `bundle install`
* Run `rake db:reset`, this will create, migrate and seed the database
* Run the tests with `bundle exec rspec`
* Run the server with `bundle exec rails s`

## Applications

We use [Doorkeeper](https://github.com/doorkeeper-gem/doorkeeper) to manage oAuth access to the API 

When seeding the database it will create 3 applications (see the seed data) that you will be able to
use to access your local API swagger documentation

Applications must be created with an array of scopes, these match the pre-defined HMRC use_cases.
```ruby
Doorkeeper::Application.create(name: 'Your application name', scopes: ['use_case_one'])
```
where `scopes:` should only be from an array of
```ruby 
use_case_one, use_case_two, use_case_three, use_case_four
```

## Authentication and authorisation

Calls to the API must generate a bearer token from their `uid` and `secret`, all subsequent calls
must be made with this bearer token in the `Authorization` header, e.g. `Authorization: Bearer <bearer-token>`

Because each call is made via a bearer token generated by an application we can track the linked Doorkeeper Application
, this allows the system to identify the calling application and ensure it is entitled to request data from the requested use_case.

It also allows the system to validate the the Application requesting a result is the one that made the initial request
